---
title: "Exploring an Environmental Justice Issue"
author: "Isabella Segarra"
date: 10-24-2025
format: 
  pdf: default 
  html: default
theme: pandoc
execute: 
  warning: false
  message: false
---

# Exploring an Environmental Justice Issue: Diesel and Ozone Pollution in California's Central Valley
          

### Objective
Utilize the U.S. Environmental Protection Agency's EJ Screen data to produce two maps communicating an environmental justice issue. 


### Environment Set-up 
```{r}
#| output: false
#| message: false

# Load relevant libraries
library(sf) # For vector data
library(stars) # For raster data 
library(tmap) # For static and interactive maps
library(here) # For importing data 
library(tidyverse) # For data cleaning
library(dplyr) # For filtering data 

```
### Load in data
Load in data from Ejscreen, California border, and California city names. These will be used to build the map and add features to it. 
```{r}
#| output: false
#| message: false


# Read in geodatabase of EJScreen data at the Census Block Group level
ejscreen <- sf::st_read(here::here("data", "ejscreen","EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb"))


# Read in California border 
california_border <- sf::st_read(here::here("data", "ca_state", "CA_State.shp"))

# Read in California cities
california_cities <- sf::st_read(here::here("data", "California_Cities-shp", "d86f1c7b-1acd-4a0a-9413-ded642940daf202042-1-425xni.o5rsz.shp"))

```

### Filter Data 
Filter the 'ejscreen' data to just geometries from California and filter for only Central Valley counties. 
```{r}
#| output: false
#| message: false
#| warning: false

# Filter to all data from California 
california <- ejscreen %>%
  dplyr::filter(ST_ABBREV == "CA") %>% 
  janitor::clean_names()


# Filter to counties in the Central Valley 
central_valley <- california %>%
  dplyr::filter(cnty_name %in% c("Merced County", 
                                 "Butte County",
                                 "Kern County",
                                 "Colusa County", 
                                 "Kings County", 
                                 "Fresno County", 
                                 "Madera County", 
                                 "Glenn County", 
                                 "Placer County", 
                                 "Sacramento County",
                                 "San Joaquin County", 
                                 "Shasta County", 
                                 "Sutter County", 
                                 "Tehama County", 
                                 "Tulare County", 
                                 "Yolo County", 
                                 "Yuba County", 
                                 "Stanislaus County"))


# Filter california_cities to major central valley cities (Sacramento, Fresno, Bakersfield, and Stockton)
central_valley_cities <- california_cities %>% 
  dplyr::filter(AREANAME %in% c("Sacramento", "Fresno", "Bakersfield", "Stockton"))
  
```

### Aggregate data 
Aggregate the central valley data frame to get the average of each county. 
```{r}
# Find the average values for all variables within counties
central_valley_counties <- aggregate(central_valley, by = list(central_valley$cnty_name), FUN = mean)
```

## Maps

### Map 1: Mapping Central Valley Diesel Particulate Matter

In the Central Valley, diesel pollution, primarily from heavy diesel trucks traveling throughout Highway 99 and the I-5, contribute to the region's significant air pollution (EPA, 2025). I decided to investigate which counties in the Central Valley see higher concentrations of diesel pollution. From the map, southern Central Valley counties experience higher levels of pollution. 

```{r}
diesel_map <- tm_shape(california_border) + # Add border of California
  tm_borders(fill = "#c4bd8b") +
  tm_shape(central_valley_counties) + # Add the central valley counties layer
  tm_polygons(
    fill = "dslpm", # Fill the counties based on diesel pollution
    fill.scale = tm_scale(values = c(
      "#ECAD09", "#D97F12", "#C5501A", "#B22222"
    )),
    fill.legend = tm_legend(title =
                              "Diesel Particulate Matter (μg/m3)", size = 0.5)
  ) +
  tm_borders(col = "black", lwd = 0.5) + # Add borders for the counties
  tm_title(
    "Diesel Pollution in Central Valley Counties of California",
    size = 1,
    fontface = "bold"
  ) +
  tm_title("Based on EPA’s AirToxScreen", size = 0.5) +
  tm_shape(central_valley_cities) + # Add central valley city names
  tm_dots(fill = "white") +
  tm_text(
    "AREANAME",
    col = "white",
    size = 0.5,
    xmod = 2.3, # Shift labels to the right
    ymod = 0.1 # Shift labels up
  ) +  # Shift labels up/down
  tm_compass(position = c("right", "top")) + # Add compass
  tm_scalebar(position = c("left", "bottom")) # Add scalebar

diesel_map # View diesel map
```
### Map 2: Mapping Central Valley Ozone 

Diesel pollution is linked to increased ozone production (EPA, 2025). Increased ozone in the atmosphere impacts the health of the ecosystem and surrounding communities. Due to this linkage, I decided to map the ozone (ppb) levels in Central Valley counties. From the map, southern Central Valley counties have increased ozone levels showing a possible connection between diesel and ozone pollution. 

```{r}

ozone_map <- tm_shape(california_border) + # Add border of California
  tm_borders(fill = "#c4bd8b") +
  tm_shape(central_valley_counties) + # Add the central valley counties layer
  tm_polygons(
    fill = "ozone", # Fill the counties based on ozone pollution
    fill.scale = tm_scale(values = c(
      "#C0C6CB", "#7688BB", "#304FAF", "#073763"
    )),
    fill.legend = tm_legend(title =
                              "Ozone (parts per billion)", size = 0.5)
  ) +
  tm_borders(col = "black", lwd = 0.5) + # Add borders for the counties
  tm_title(
    "Ozone Pollution in Central Valley Counties of California",
    size = 1,
    fontface = "bold"
  ) +
  tm_title(
    "Ozone annual mean top 10 of daily maximum 8-hour concentration in air. EJScreen v2.2",
    size = 0.5
  ) +
  tm_shape(central_valley_cities) + # Add central valley city names
  tm_dots(fill = "white") +
  tm_text(
    "AREANAME",
    col = "white",
    size = 0.5,
    xmod = 2.3,  # Shift labels to the right
    ymod = 0.1 # Shift labels up
  ) + 
  tm_compass(position = c("right", "top")) + # Add compass
  tm_scalebar(position = c("left", "bottom")) # Add scalebar

ozone_map # View ozone map

```

